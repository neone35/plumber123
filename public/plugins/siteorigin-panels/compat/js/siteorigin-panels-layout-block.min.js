!function(e,n,t,o,i,a){var s=o.createElement,l=e.BlockControls,r=a.withState,u=i.Toolbar,d=i.IconButton,c=i.Spinner,p=t.__;n.registerBlockType("siteorigin-panels/layout-block",{title:p("SiteOrigin Layout (in beta)"),description:p("Build a layout using SiteOrigin's Page Builder."),icon:function(){return s("span",{className:"siteorigin-panels-gutenberg-icon"})},category:"layout",supports:{html:!1},attributes:{panelsData:{type:"object"}},edit:r({editing:!0,panelsInitialized:!1,loadingPreview:!1,previewHtml:""})(function(e){function n(){e.attributes.panelsData&&($.post(soPanelsGutenbergAdmin.previewUrl,{action:"so_panels_gutenberg_preview",panelsData:JSON.stringify(e.attributes.panelsData)}).then(function(n){n.html&&e.setState({previewHtml:n.html,loadingPreview:!1})}),e.setState({editing:!1,loadingPreview:!0}))}function t(){a||($(document).trigger("panels_setup_preview"),window.sowb&&$(window.sowb).trigger("setup_widgets"))}function o(){e.setState({editing:!0,panelsInitialized:!1})}function i(n){function t(){e.toggleSelection(!1),$(document).on("mouseup",function n(){e.toggleSelection(!0),$(document).off("mouseup",n)})}if(!e.panelsInitialized){var o=jQuery(n),i={editorType:"standalone"},a=new panels.model.builder,s=new panels.view.builder({model:a,config:i}),l=JSON.parse(JSON.stringify($.extend({},e.attributes.panelsData)));s.on("row_added",function(){s.$(".so-row-move").off("mousedown",t),s.$(".so-row-move").on("mousedown",t),s.$(".so-widget").off("mousedown",t),s.$(".so-widget").on("mousedown",t)}),s.on("widget_added",function(){s.$(".so-widget").off("mousedown",t),s.$(".so-widget").on("mousedown",t)}),s.render().attach({container:o}).setData(l),s.trigger("builder_resize"),s.on("content_change",function(){e.setAttributes({panelsData:s.getData()})}),$(document).trigger("panels_setup",s),e.setState({panelsInitialized:!0})}}var a=e.editing,r=e.loadingPreview;if(a)return[s(l,{key:"controls"},s(u,null,s(d,{className:"components-icon-button components-toolbar__control",label:p("Preview layout."),onClick:n,icon:"visibility"}))),s("div",{key:"pageBuilder",className:"siteorigin-panels-layout-block-container",ref:i})];var w=e.previewHtml;return[s(l,{key:"controls"},s(u,null,s(d,{className:"components-icon-button components-toolbar__control",label:p("Edit layout."),onClick:o,icon:"edit"}))),s("div",{key:"preview",className:"so-panels-gutenberg-layout-preview-container"},r?s("div",{className:"so-panels-spinner-container"},s("span",null,s(c))):s("div",{dangerouslySetInnerHTML:{__html:w},ref:t}))]}),save:function(){return null}})}(window.wp.editor,window.wp.blocks,window.wp.i18n,window.wp.element,window.wp.components,window.wp.compose);