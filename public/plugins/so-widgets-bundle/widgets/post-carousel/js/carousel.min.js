var sowb=window.sowb||{};jQuery(function(e){sowb.setupCarousel=function(){e(".sow-carousel-wrapper").each(function(){var s=e(this),t=s.closest(".sow-carousel-container"),n=s.closest(".sow-carousel-container").parent(),a=s.find(".sow-carousel-items"),o=s.find(".sow-carousel-item"),i=o.eq(0),r=0,l=1,c=!1,u=o.length,w=s.data("found-posts"),f=u===w,d=i.width()+parseInt(i.css("margin-right")),p=t.hasClass("js-rtl"),h=p?"margin-right":"margin-left",g=function(){if(r<0&&(r=0),r>=s.find(".sow-carousel-item").length-1&&(r=s.find(".sow-carousel-item").length-1,!c&&!f)){c=!0,l++,a.append('<li class="sow-carousel-item sow-carousel-loading"></li>');var t=n.find('input[name="instance_hash"]').val();e.get(s.data("ajax-url"),{query:s.data("query"),action:"sow_carousel_load",paged:l,instance_hash:t},function(t,n){e(t.html).appendTo(a).hide().fadeIn(),s.find(".sow-carousel-loading").remove(),u=s.find(".sow-carousel-item").length,f=u===w,c=!1})}a.css("transition-duration","0.45s"),a.css(h,-d*r+"px")};if(n.on("click","a.sow-carousel-previous",function(e){e.preventDefault(),r-=p?-1:1,g()}),n.on("click","a.sow-carousel-next",function(e){e.preventDefault(),r+=p?-1:1,g()}),"function"==typeof s.swipe){var m,v=!1,b=0,D=0,I=0,T=0,x=p?"right":"left",_=function(e){return e<50&&e>-d*u&&(a.css("transition-duration","0s"),a.css(h,e+"px"),!0)},y=function(){var e=parseInt(a.css(h));r=Math.abs(Math.round(e/d)),g()};s.on("click",".sow-carousel-item a",function(e){v&&(e.preventDefault(),v=!1)}),s.swipe({excludedElements:"",triggerOnTouchEnd:!0,threshold:75,swipeStatus:function(e,s,t,n,a,o,i){if("up"===t||"down"===t)return!1;if("start"===s)D=-d*r,T=(new Date).getTime(),clearInterval(m);else if("move"===s){t===x&&(n*=-1),_(D+n);var l=(new Date).getTime(),c=(l-T)/1e3;I=(n-b)/c,T=l,b=n}else if("end"===s)if(v=!0,t===x&&(n*=-1),Math.abs(I)>400){I*=.1;var u=(new Date).getTime(),w=0;m=setInterval(function(){var e=((new Date).getTime()-u)/1e3;w+=I*e;var s=D+n+w,a=Math.abs(I)-30<0;t===x?I+=30:I-=30,!a&&_(s)||(clearInterval(m),y())},20)}else y();else"cancel"===s&&g()}})}})},sowb.setupCarousel(),e(sowb).on("setup_widgets",sowb.setupCarousel)}),window.sowb=sowb;