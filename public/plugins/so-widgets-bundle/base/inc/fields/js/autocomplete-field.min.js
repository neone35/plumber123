!function(e){e(document).on("sowsetupformfield",".siteorigin-widget-field-type-autocomplete",function(t){var i=e(this);if(!i.data("initialized")){var n=function(){var e=i.find("input.siteorigin-widget-input").val();return 0===e.length?[]:e.split(",")},a=function(){var t=n();i.find("ul.items > li").each(function(i,n){var a=e(this);t.indexOf(a.data("value"))>-1?a.addClass("selected"):a.removeClass("selected")})},l=null,s=function(){null!==l&&l.abort();var t=i.find(".content-text-search"),n=t.val(),a=t.data("source"),s=t.data("postTypes"),o={action:"so_widgets_search_"+a};"posts"===a?(o.query=n,o.postTypes=s):"terms"===a&&(o.term=n);var d=i.find("ul.items").empty().addClass("loading");return e.get(soWidgets.ajaxurl,o,function(t){t.forEach(function(t){""===t.label&&(t.label="&nbsp;"),d.append(e("<li>").html(t.label+"<span>("+t.type+")</span>").data(t))}),d.removeClass("loading")})};i.find(".siteorigin-widget-autocomplete-input").click(function(){var t=i.find(".existing-content-selector");t.show();var n=new e.Deferred;t.is(":visible")&&0===t.find("ul.items li").length?n=s():n.resolve(),n.done(a)});var o=function(){i.find(".existing-content-selector").hide()};e(window).mousedown(function(e){0===i.find(e.target).length&&o()}),i.find(".button-close").click(o),i.on("click",".items li",function(t){t.preventDefault();var a=e(this),l=n(),s=a.data("value"),o=l.indexOf(s);o>-1?(l.splice(o,1),a.removeClass("selected")):(l.push(s),a.addClass("selected"));var d=i.find("input.siteorigin-widget-input");d.val(l.join(",")),d.change()});var d=null;i.find(".content-text-search").keyup(function(){null!==d&&clearTimeout(d),d=setTimeout(function(){s()},500)}),i.data("initialized",!0)}})}(jQuery);